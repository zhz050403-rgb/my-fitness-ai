<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Coach Pro | æ™ºèƒ½ç§äººè®¢åˆ¶æ•™ç»ƒ</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        :root { --accent: #6366f1; --glass: rgba(255, 255, 255, 0.7); }
        body { 
            margin: 0; padding: 20px; min-height: 100vh;
            display: flex; justify-content: center; align-items: center;
            font-family: -apple-system, sans-serif;
            background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
        }
        @keyframes gradientBG { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }

        .glass-card {
            background: var(--glass);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 30px; padding: 30px; width: 100%; max-width: 450px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.15); box-sizing: border-box;
        }

        h1 { text-align: center; color: #1f2937; font-size: 1.5rem; margin-bottom: 25px; }
        .auth-section { background: rgba(99, 102, 241, 0.1); border: 1px solid rgba(99, 102, 241, 0.2); padding: 20px; border-radius: 20px; margin-bottom: 25px; }
        .auth-section input { width: 100%; background: white; border: 2px solid #e0e7ff; padding: 12px; border-radius: 12px; font-size: 1.2rem; font-weight: bold; text-align: center; letter-spacing: 3px; color: #4f46e5; box-sizing: border-box; outline: none; }

        .input-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
        .input-group { display: flex; flex-direction: column; margin-bottom: 15px; }
        .input-group label { font-size: 0.75rem; font-weight: 600; color: #6b7280; margin-bottom: 5px; margin-left: 5px; }
        
        input[type="number"], select, textarea { padding: 12px; border: 1px solid rgba(0,0,0,0.1); border-radius: 12px; background: rgba(255,255,255,0.5); font-size: 14px; outline: none; transition: 0.3s; }
        input:focus, select:focus { border-color: var(--accent); background: white; }
        textarea { height: 60px; resize: none; }

        #customTargetWrapper { display: none; margin-top: 10px; animation: slideDown 0.3s ease; }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

        button { width: 100%; padding: 16px; border: none; border-radius: 15px; background: #1f2937; color: white; font-size: 1rem; font-weight: bold; cursor: pointer; transition: 0.3s; margin-top: 10px; }
        button:hover { transform: translateY(-2px); background: #000; }
        #output { margin-top: 30px; line-height: 1.7; color: #374151; }
        .loading { text-align: center; color: #6366f1; font-weight: bold; }
    </style>
</head>
<body>

<div class="glass-card">
    <h1>ğŸ¯ AI Coach Pro</h1>

    <div class="auth-section">
        <label style="display:block; font-size:0.7rem; color:#4f46e5; margin-bottom:8px; text-align:center;">è¯·è¾“å…¥ 10 ä½æˆæƒç è§£é”</label>
        <input type="text" id="authCode" maxlength="10" placeholder="ACTIVATE">
    </div>

    <div class="input-grid">
        <div class="input-group"><label>æ€§åˆ«</label><select id="gender" onchange="updateTargets()"><option value="å¥³">å¥³ç”Ÿ</option><option value="ç”·">ç”·ç”Ÿ</option></select></div>
        <div class="input-group"><label>å¹´é¾„</label><input type="number" id="age" value="25"></div>
        <div class="input-group"><label>èº«é«˜(cm)</label><input type="number" id="h" value="160"></div>
        <div class="input-group"><label>ä½“é‡(kg)</label><input type="number" id="w" value="50"></div>
    </div>

    <div class="input-group"><label>èº«ä½“çŠ¶æ€</label><textarea id="status" placeholder="å¦‚ï¼šä¹…åè…°ç–¼ã€è†ç›–å—è¿‡ä¼¤..."></textarea></div>
    
    <div class="input-group">
        <label>èº«æç›®æ ‡</label>
        <select id="dream" onchange="toggleCustomInput()">
            <option>é©¬ç”²çº¿å¡‘å½¢ (ç´§è‡´çº¿æ¡)</option>
            <option>è¶…æ¨¡ç›´è§’è‚© (æ”¹å–„ä½“æ€)</option>
            <option>èœœæ¡ƒè‡€æ‰“é€  (åŠ›é‡å¡‘å½¢)</option>
            <option>å…¨èº«æ•ˆå‡è„‚ (è½»ç›ˆä½“æ„Ÿ)</option>
            <option value="other">å…¶ä»–ï¼ˆè‡ªè¡Œå¡«å†™ï¼‰</option>
        </select>
        <div id="customTargetWrapper">
            <input type="text" id="customTarget" placeholder="è¯·è¾“å…¥æ‚¨çš„å…·ä½“è¦æ±‚ï¼Œå¦‚ï¼ša...b...c...">
        </div>
    </div>

    <button onclick="handleExecute()">ç”Ÿæˆä¸“å±æ·±åº¦è®¡åˆ’</button>
    <div id="output"></div>
</div>

<script>
    // 1. æ€§åˆ«ä¸ç›®æ ‡çš„è”åŠ¨é€»è¾‘
    function updateTargets() {
        const gender = document.getElementById('gender').value;
        const targetSelect = document.getElementById('dream');
        const femaleOptions = `
            <option>é©¬ç”²çº¿å¡‘å½¢ (ç´§è‡´çº¿æ¡)</option>
            <option>è¶…æ¨¡ç›´è§’è‚© (æ”¹å–„ä½“æ€)</option>
            <option>èœœæ¡ƒè‡€æ‰“é€  (åŠ›é‡å¡‘å½¢)</option>
            <option>å…¨èº«æ•ˆå‡è„‚ (è½»ç›ˆä½“æ„Ÿ)</option>
            <option value="other">å…¶ä»–ï¼ˆè‡ªè¡Œå¡«å†™ï¼‰</option>
        `;
        const maleOptions = `
            <option>æ‰“é€ éº’éºŸè‡‚ (ä¸Šè‚¢å……è¡€æ„Ÿ)</option>
            <option>å…¬ç‹—è…°/è…¹è‚Œ (æ ¸å¿ƒåˆ»ç”»)</option>
            <option>å®½è‚©å€’ä¸‰è§’ (å¢è‚Œåšåº¦)</option>
            <option>ç¡¬æ±‰å‡è„‚ (é«˜æ•ˆç‡ƒè„‚)</option>
            <option value="other">å…¶ä»–ï¼ˆè‡ªè¡Œå¡«å†™ï¼‰</option>
        `;
        targetSelect.innerHTML = (gender === 'å¥³') ? femaleOptions : maleOptions;
        toggleCustomInput(); // é‡ç½®è‡ªå®šä¹‰è¾“å…¥æ¡†çŠ¶æ€
    }

    // 2. æ˜¾ç¤º/éšè—è‡ªå®šä¹‰è¾“å…¥æ¡†
    function toggleCustomInput() {
        const targetSelect = document.getElementById('dream');
        const customWrapper = document.getElementById('customTargetWrapper');
        customWrapper.style.display = (targetSelect.value === 'other') ? 'block' : 'none';
    }

    async function handleExecute() {
        const code = document.getElementById('authCode').value.trim().toUpperCase();
        const out = document.getElementById('output');

        // ğŸ” æ ¡éªŒç®—æ³•ï¼šç¬¬4ä½ASCIIå‡å»ç¬¬8ä½ASCIIå¿…é¡»ç­‰äº3ï¼Œä¸”å«K
        const checkCode = (s) => (s.length === 10 && s.includes("K") && (s.charCodeAt(3) - s.charCodeAt(7) === 3));

        if(!checkCode(code)) {
            alert("âŒ æˆæƒç æ— æ•ˆï¼"); return;
        }

        out.innerHTML = "<p class='loading'>ğŸ’ æˆæƒæˆåŠŸï¼æ­£åœ¨è§„åˆ’æ–¹æ¡ˆ...</p>";

        // è·å–ç›®æ ‡ï¼šå¦‚æœæ˜¯å…¶ä»–ï¼Œåˆ™å–è¾“å…¥æ¡†çš„å€¼
        let finalTarget = document.getElementById('dream').value;
        if (finalTarget === 'other') {
            finalTarget = document.getElementById('customTarget').value || "è‡ªå®šä¹‰ç›®æ ‡";
        }

        const info = {
            g: document.getElementById('gender').value,
            a: document.getElementById('age').value,
            h: document.getElementById('h').value,
            w: document.getElementById('w').value,
            s: document.getElementById('status').value || "å¥åº·",
            d: finalTarget
        };

        // âš ï¸ è¯·å¡«å…¥ä½ çš„ KEY
        const KEY = "AIzaSyC_9B_ze95qDMD3FIls6lRpScUCvuiGd0g";
        const URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${KEY}`;

        const prompt = `ä½ æ˜¯ä¸€ä½ä¸“ä¸šç§æ•™ã€‚èµ„æ–™ï¼š${info.g}æ€§ï¼Œ${info.a}å²ï¼Œ${info.h}cm/${info.w}kgã€‚èº«ä½“ï¼š${info.s}ã€‚ç›®æ ‡ï¼š${info.d}ã€‚è¯·æä¾›ä¸€å‘¨è®¡åˆ’ã€é¥®é£Ÿå»ºè®®å’ŒBMIè¯Šæ–­ï¼Œç”¨Markdownæ ¼å¼ã€‚`;

        try {
            const resp = await fetch(URL, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
            });
            const data = await resp.json();
            out.innerHTML = marked.parse(data.candidates[0].content.parts[0].text);
        } catch (e) {
            out.innerHTML = "<p style='color:red'>âŒ è¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œå·¥å…·ã€‚</p>";
        }
    }
</script>
</body>
</html>
